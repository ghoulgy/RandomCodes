import os 
import json

data_json_full_path = os.path.join(os.getcwd(), "data.json")
data_json_context = open(data_json_full_path, "r")
dll_func_dict = json.load(data_json_context)
get_func_addr = 0x192B998
xrefs = CodeRefsTo(get_func_addr, 0)

for xref in xrefs:
    index = 0
    while(index <= 13):
        prev_addr = idc.prev_head(xref)
    
        if print_insn_mnem(prev_addr) == "mov" and get_operand_value(prev_addr, 0) == 2: # 2 = register 
            if get_operand_type(prev_addr, 1) == idc.o_imm:
                djb2_hash_addr = hex(prev_addr)
                matched_func_name = dll_func_dict.get(str(get_operand_value(prev_addr, 1)), False)
                
                print(f"{djb2_hash_addr}: {matched_func_name}")
                if matched_func_name:
                    idc.set_cmt(prev_addr, matched_func_name, 1)

                break

        index += 1
        xref = prev_addr
