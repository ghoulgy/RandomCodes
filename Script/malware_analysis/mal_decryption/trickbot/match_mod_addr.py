# Matching the address with its corresponding export function from the modded library 
import pefile
import sys
import os

extracted_addr = {
    "2009994832": True,
    "2009994256": True,
    "2009994864": True,
    "2009830272": True,
    "8791752913584": True,
    "8791752908080": True,
    "8791752910400": True,
    "8791752989632": True,
    "8791752906000": True,
    "8791752906400": True,
    "8791795050048": True,
    "8791795050272": True,
    "8791795084832": True,
    "8791795059904": True,
    "8791795059072": True,
    "8791762485656": True,
    "8791762594208": True,
    "8791721670956": True,
    "8791769220736": True,
    "8791769289492": True,
    "8791769209296": True,
    "8791769314448": True,
    "8791769191280": True,
    "8791769261340": True,
    "8791764217708": True,
    "8791764284800": True,
    "8791764246224": True,
    "8791764228800": True,
    "8791764286880": True,
    "8791764285920": True,
    "8791764284832": True,
    "8791764228820": True,
    "8791764246592": True,
    "8791764226832": True,
    "8791764285592": True,
    "8791764284988": True,
    "8791764228480": True,
    "8791764285464": True,
    "8791764229376": True,
    "8791764415752": True,
    "8791764305648": True,
    "8791764228896": True,
    "8791764228864": True,
    "8791764246480": True,
    "8791764206624": True,
    "8791764305680": True,
    "8791764217760": True,
    "8791764229392": True,
    "8791764285872": True,
    "8791764229844": True,
    "8791764286832": True,
    "8791764284704": True,
    "8791764286800": True,
    "8791764416208": True,
    "8791764228492": True,
    "8791764217832": True,
    "8791764285472": True,
    "2007512992": True,
    "2007503808": True,
    "2007504128": True,
    "2007466672": True,
    "2007743280": True,
    "2007522576": True,
    "2010001344": True,
    "2007571376": True,
    "2007745776": True,
    "2007527712": True,
    "2007527648": True,
    "2007519888": True,
    "2007743296": True,
    "2007440896": True,
    "2007503776": True,
    "2010001408": True,
    "2008020976": True,
    "2007527280": True,
    "2007513216": True,
    "2007527136": True,
    "2007578096": True,
    "2007576016": True,
    "2007550640": True,
    "2007575328": True,
    "2007524576": True,
    "2007477616": True,
    "2007575472": True,
    "2007531632": True,
    "2007488784": True,
    "2007522544": True,
    "2007743376": True,
    "2007514816": True,
    "2007743648": True,
    "2007499216": True,
    "2007834688": True,
    "2010594000": True,
    "2007576656": True,
    "2007477648": True,
    "2007503184": True,
    "2007831088": True,
    "2007547344": True,
    "2007576448": True,
    "2007488928": True,
    "2007514944": True,
    "2007503152": True,
    "2007517088": True,
    "2007743344": True,
    "2007505200": True,
    "2007480288": True,
    "2007575408": True,
    "2010002336": True,
    "2007441648": True,
    "2007743440": True,
    "2009874208": True,
    "2007514880": True,
    "2007505168": True,
    "2007578416": True,
    "2007524736": True,
    "2007744560": True,
    "2007527296": True,
    "2007505008": True,
    "2007453568": True,
    "2007903376": True,
    "2007547264": True,
    "2007743936": True,
    "2007578016": True,
    "2007572816": True,
    "2007576688": True,
    "2007554496": True,
    "2007522128": True,
    "2007547232": True,
    "2007575296": True,
    "2007550704": True,
    "2009809136": True,
    "2007578256": True,
    "2007441888": True,
    "2007550672": True,
    "2007743904": True,
    "2007529184": True,
    "2007743184": True,
    "2007529216": True,
    "2007486768": True,
    "8791746875568": True,
    "8791746875520": True,
    "8791746885232": True,
    "8791746875760": True,
    "8791793013120": True,
    "8791793013744": True,
    "8791793022080": True,
    "8791793013536": True,
    "2008703248": True,
    "2008705328": True,
    "2008636720": True,
    "2008703604": True,
    "8791753840112": True,
    "8791753841712": True,
    "8791754012320": True,
    "8791753857424": True,
    "8791775275248": True,
    "8791775328544": True,
    "8791775312752": True,
    "8791775324928": True,
    "8791775330160": True,
    "8791775438528": True,
    "8791775312464": True,
    "8791712638316": True,
    "8791712611900": True,
    "8791712548344": True,
    "8791712543784": True,
    "8791712560336": True,
    "8791712583784": True,
    "8791712588256": True,
    "8791712580780": True,
    "8791712652540": True,
    "8791712590948": True,
    "8791712545220": True,
    "8791712539360": True,
    "8791776312228": True,
}


def export_matching(dll_binary):
    for exp in dll_binary.DIRECTORY_ENTRY_EXPORT.symbols:
        # print(str(dll_binary.OPTIONAL_HEADER.ImageBase + exp.address))
        export_addr = str(dll_binary.OPTIONAL_HEADER.ImageBase + exp.address)
        # print(extracted_addr.get(str(dll_binary.OPTIONAL_HEADER.ImageBase + exp.address), False))
        if extracted_addr.get(str(dll_binary.OPTIONAL_HEADER.ImageBase + exp.address), False) == True:
            print(f'"{export_addr}": "{exp.name.decode("utf-8")}",')
        # if extracted_addr[str(dll_binary.OPTIONAL_HEADER.ImageBase + exp.address)]:
        #     print(f'{func.address} {exp.name.decode("utf-8")}')


executor_file_path = os.path.dirname(os.path.realpath(__file__))
modded_dll_folder = os.path.join(executor_file_path, "zz")

if os.path.isdir(modded_dll_folder):
    file_names = os.listdir(modded_dll_folder)
    for file_name in file_names:
        if os.path.isfile(os.path.join(modded_dll_folder,file_name)):
            dll_binary = pefile.PE(os.path.join(modded_dll_folder, file_name))
            export_matching(dll_binary)

# "8791752913584": "BCryptCloseAlgorithmProvider",
# "8791752906400": "BCryptDestroyKey",
# "8791752906000": "BCryptGetProperty",
# "8791752908080": "BCryptImportKeyPair",
# "8791752910400": "BCryptOpenAlgorithmProvider",
# "8791752989632": "BCryptVerifySignature",
# "8791762485656": "CryptBinaryToStringW",
# "8791762594208": "CryptStringToBinaryW",
# "8791754012320": "NCryptDeleteKey",
# "8791753841712": "NCryptFreeObject",
# "8791753840112": "NCryptImportKey",
# "8791753857424": "NCryptOpenStorageProvider",
# "8791712539360": "WinHttpCloseHandle",
# "8791712611900": "WinHttpConnect",
# "8791712638316": "WinHttpGetIEProxyConfigForCurrentUser",
# "8791712543784": "WinHttpOpen",
# "8791712548344": "WinHttpOpenRequest",
# "8791712652540": "WinHttpQueryDataAvailable",
# "8791712580780": "WinHttpQueryHeaders",
# "8791712588256": "WinHttpReadData",
# "8791712583784": "WinHttpReceiveResponse",
# "8791712560336": "WinHttpSendRequest",
# "8791712545220": "WinHttpSetOption",
# "8791712590948": "WinHttpSetTimeouts",
# "8791746875568": "CreateEnvironmentBlock",
# "8791746875520": "DestroyEnvironmentBlock",
# "8791746875760": "LoadUserProfileW",
# "8791746885232": "UnloadUserProfile",
# "8791769220736": "CLSIDFromString",
# "8791769209296": "CoCreateGuid",
# "8791769314448": "CoCreateInstance",
# "8791769261340": "CoInitialize",
# "8791769289492": "CoUninitialize",
# "8791769191280": "StringFromCLSID",
# "8791764285872": "AdjustTokenPrivileges",
# "8791764284988": "AllocateAndInitializeSid",
# "8791764228480": "CheckTokenMembership",
# "8791764246592": "ConvertStringSecurityDescriptorToSecurityDescriptorW",
# "8791764286880": "CopySid",
# "8791764217832": "CreateProcessAsUserW",
# "8791764228492": "CryptAcquireContextW",
# "8791764228820": "CryptCreateHash",
# "8791764416208": "CryptDecrypt",
# "8791764228864": "CryptDestroyHash",
# "8791764217760": "CryptDestroyKey",
# "8791764228896": "CryptGetHashParam",
# "8791764228800": "CryptHashData",
# "8791764217708": "CryptImportKey",
# "8791764229392": "CryptReleaseContext",
# "8791764415752": "CryptSetKeyParam",
# "8791764226832": "DuplicateTokenEx",
# "8791764285472": "EqualSid",
# "8791764285464": "FreeSid",
# "8791764284800": "GetLengthSid",
# "8791764286800": "GetTokenInformation",
# "8791764246480": "GetUserNameW",
# "8791764229844": "LookupAccountNameW",
# "8791764285592": "LookupAccountSidW",
# "8791764285920": "LookupPrivilegeValueW",
# "8791764286832": "OpenProcessToken",
# "8791764305680": "RegCloseKey",
# "8791764284704": "RegCreateKeyExW",
# "8791764305648": "RegOpenKeyExW",
# "8791764246224": "RegSetValueExW",
# "8791764229376": "RevertToSelf",
# "8791764284832": "SetSecurityDescriptorDacl",
# "8791764206624": "SetSecurityInfo",
# "2009994832": "NtDelayExecution",
# "2009994256": "NtQueryObject",
# "2009994864": "NtQuerySystemInformation",
# "2010594000": "RtlAddVectoredExceptionHandler",
# "2010002336": "RtlAllocateHeap",
# "2010001344": "RtlEnterCriticalSection",
# "2009809136": "RtlExitUserProcess",
# "2009994864": "RtlGetNativeSystemInformation",
# "2009830272": "RtlGetVersion",
# "2010001408": "RtlLeaveCriticalSection",
# "2009874208": "RtlReAllocateHeap",
# "2009994832": "ZwDelayExecution",
# "2009994256": "ZwQueryObject",
# "2009994864": "ZwQuerySystemInformation",
# "8791795050048": "FreeAddrInfoW",
# "8791795059904": "WSACleanup",
# "8791795059072": "WSAStartup",
# "8791795050048": "freeaddrinfo",
# "8791795050272": "getaddrinfo",
# "8791795084832": "gethostname",
# "8791776312228": "SHGetFolderPathW",
# "2008636720": "CharLowerBuffA",
# "2008703604": "DispatchMessageA",
# "2008703248": "GetMessageA",
# "2008705328": "SetTimer",
# "2007576448": "CloseHandle",
# "2007477616": "CreateDirectoryW",
# "2007519888": "CreateEventW",
# "2007505008": "CreateFileW",
# "2007503808": "CreateMutexW",
# "2007571376": "CreateProcessW",
# "2007745776": "CreateRemoteThread",
# "2007524736": "CreateThread",
# "2007441888": "CreateToolhelp32Snapshot",
# "2007477648": "DeleteFileW",
# "2007522576": "DuplicateHandle",
# "2007547232": "FindClose",
# "2007547264": "FindFirstFileW",
# "2007505168": "FindNextFileW",
# "2007486768": "GetComputerNameW",
# "2007522544": "GetCurrentProcess",
# "2007503152": "GetExitCodeThread",
# "2007547344": "GetFileAttributesW",
# "2007453568": "GetFileTime",
# "2007529184": "GetFullPathNameW",
# "2007576016": "GetLastError",
# "2007529216": "GetModuleFileNameW",
# "2007578416": "GetModuleHandleW",
# "2007480288": "GetNativeSystemInfo",
# "2007578256": "GetProcAddress",
# "2007576656": "GetProcessHeap",
# "2007531632": "GetStartupInfoW",
# "2007527712": "GetSystemDirectoryW",
# "2007527280": "GetSystemInfo",
# "2007514944": "GetSystemTimeAsFileTime",
# "2007744560": "GetTempFileNameW",
# "2007834688": "GetTempPathW",
# "2007575296": "GetTickCount",
# "2007499216": "GetVersion",
# "2007488784": "GetVersionExW",
# "2007572816": "GetVolumeInformationW",
# "2007466672": "GetWindowsDirectoryW",
# "2007527648": "HeapCreate",
# "2007576688": "HeapFree",
# "2007524576": "InitializeCriticalSectionAndSpinCount",
# "2007527296": "LoadLibraryW",
# "2007517088": "LocalFree",
# "2008020976": "MoveFileW",
# "2007522128": "MultiByteToWideChar",
# "2007550672": "OpenProcess",
# "2007440896": "Process32FirstW",
# "2007441648": "Process32NextW",
# "2007504128": "ReadFile",
# "2007743936": "ReadProcessMemory",
# "2007743904": "RemoveDirectoryW",
# "2007488928": "ResetEvent",
# "2007503776": "ResumeThread",
# "2007550640": "SetCurrentDirectoryW",
# "2007527136": "SetEnvironmentVariableW",
# "2007514880": "SetEvent",
# "2007512992": "SetFileAttributesW",
# "2007503184": "SetFilePointer",
# "2007513216": "SetFileTime",
# "2007903376": "SignalObjectAndWait",
# "2007575408": "Sleep",
# "2007575472": "SleepEx",
# "2007743648": "TerminateProcess",
# "2007743440": "VirtualAllocEx",
# "2007743376": "VirtualFreeEx",
# "2007743344": "VirtualProtectEx",
# "2007575328": "WaitForSingleObject",
# "2007578096": "WideCharToMultiByte",
# "2007743296": "Wow64DisableWow64FsRedirection",
# "2007743280": "Wow64RevertWow64FsRedirection",
# "2007578016": "WriteFile",
# "2007743184": "WriteProcessMemory",
# "2007831088": "lstrcmp",
# "2007831088": "lstrcmpA",
# "2007554496": "lstrcmpW",
# "2007505200": "lstrcmpiW",
# "2007550704": "lstrlenA",
# "2007514816": "lstrlenW",
# "8791775330160": "PathAddBackslashW",
# "8791775324928": "PathFindExtensionW",
# "8791775328544": "PathFindFileNameW",
# "8791775438528": "PathRenameExtensionW",
# "8791775312464": "StrChrW",
# "8791775312752": "StrStrIW",
# "8791775275248": "StrStrW",
# "8791721670956": "GetAdaptersInfo",
# "8791793022080": "SysAllocString",
# "8791793013536": "SysFreeString",
# "8791793013120": "VariantClear",
# "8791793013744": "VariantInit",
